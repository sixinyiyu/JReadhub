# MQ的应用场景

面试的时候一般会问，项目中看你有用到MQ，那你们是哪些场景用到了MQ，用MQ是解决了什么，为什么要用MQ？

MQ主要是做：系统解耦、流量削峰、异步

* 系统解耦

以电商系统为例：支付中心在获取到支付结果后需要通知订单中心、营销中心、用户中心、ERP甚至还有消息中心等系统，传统方式为系统之间提供接口互相调用；这种方式有几个弊端需要考虑接口高可用(调用失败、超时、系统挂了)，接入系统的代码杂乱后续维护难(接入系统新增、下线)，这样支付中心就跟其他系统高度耦合了，采用MQ解耦的话支付中心只负责保证消息落地到MQ，其他业务系统如果需要关注支付结果的直接接听MQ即可，消费者（其他业务系统）只需要关注MQ中心对于消息生产者(支付执行)根本不需要关注，消费者的增减对原支付中心没有任何影响，增加了系统的可拓展性、维护性。

像这样多个系统需要关注某个数据的变化，可以根据业务考虑使用MQ解耦，数据变化方负责落地消息到MQ，关注方自己去监听MQ做业务；采用的是经典的发布/订阅模式。

* 异步

以用户注册为例：用户注册后还有其他几个流程(发送欢迎邮件、发送新用户优惠券等操作)，如果串行执行接口响应时长会比较长，用户体验不好，而且容易因为附加功能的失败影响主流程。用户注册后直接写入MQ数据，迎新邮件、迎新优惠券监听MQ处理逻辑，能很好的加快接口响应。


* 流量削峰

以抢购为例：抢购流量低估时并发量100，系统能很好的处理；高峰时并发量5000，这个时候系统就扛不住了，需要采用削峰处理使系统安然度过；首先消费MQ的时候采用的是拉模式，用户请求过来的时候直接落地到MQ，业务系统从MQ领取请求进行处理，处理完后继续拉取下一条，高峰前业务处理速度小于消息存入MQ中，高峰过后业务处理速度就大于消息存入MQ速度；慢慢就处理完！这里需要考虑高峰MQ累积的时候问题。


#### MQ的缺点

* 降低系统可用性，系统增加了额外的依赖

* 增加系统复杂性(消息重复消费、消息丢失等情况)

* 系统一致性的问题